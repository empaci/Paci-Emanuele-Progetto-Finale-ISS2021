<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>parkManagerService_1</title></head>
    
<body>
<div id="top">
<h1>LABORATORIO DI INGEGNERIA DEI SISTEMI SOFTWARE <font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
 
A company intends to build an <i>automating parking service</i> composed of a set of elements:

<ul>
<li>A software system, named <em>ParkManagerService</em>, that implements the required automation functions.</li>
<li>A <tt>DDR</tt> robot working as a <em>transport trolley</em>, that is intially situated in its <em>home</em> location. 
The <tt>transport trolley</tt> has the form of a square of side length <em>RD</em>.
</li>
<li>A <em>parking-area</em> is an empty room that includes;
	<ul>
	<li>an <em>INDOOR</em> to enter the car in the area. Facing the <tt>INDOOR</tt>, there is
	a <em>INDOOR-area</em> equipped with a <em>weigthsensor</em> that measures the <em>weigth</em> of the car;</li>
	<li>an <em>OUTDOOR</em> to exit from the <tt>parking-area</tt>. Just after the <tt>OUTDOOR</tt>, there is
	<em>OUTDOOR-area</em> equipped with a <em>outsonar</em>, used to detect the presence of a car.
	The <tt>OUTDOOR-area</tt>, once engaded by a car, should be freed within a prefixed interval of time <em>DTFREE</em>; </li>
	<li>a number <tt>N (N=6)</tt> of <em>parking-slots</em>;</li>
	<li>a <em>thermometer</em> that measures the temperature <em>TA</em> of the area;</li>
	<li>a <em>fan</em> that should be activated when <k>TA > TMAX</k>, where <em>TMAX</em> is a prefixed value (e.g. <tt>35</tt>)</li>
	</ul>
	A <em>map</em> of the parking area, represented as a grid of squares of side length <em>RD</em>, 
	is available in the file <a href="parkingMap.txt" target="code">parkingMap.txt</a>:
	<pre>
|r, 0, 0, 0, 0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, 0, 0, 0, 0, 0, X, 
|X, X, X, X, X, X, X, X, </pre>
	The map includes the positions of the  <tt>parking-slots</tt> (marked above with the symbol <k>X</k>) 
	and of the <em>fixed obstacles</em> in the area (the walls marked with the symbol <b>X</b>).
	<br/><br/>
	The area marked with <k>X</k> is a sort of 'equipped area' upon which the <tt>transport trolley</tt> cannot walk.
	Thus, to get the car in the <tt>parking-slot</tt> <ks>(2,2)</ks>, the <tt>transport trolley</tt> must
	go in cell <ks>(1,2)</ks>.
	<br/><br/>

	The proper scene for the WEnv is reported in: <a href="parkingAreaConfig.js" target="code">parkingAreaConfig.js</a>
 
	
	<center><img src="./img/parkingAreaZone.PNG" alt="parkingAreaZone.PNG" width="45%" height="32%"/></center>
</li>	
<li>a <em>parking-manager</em> (an human being) which supervises the state of the <tt>parking-area</tt>
and handles critical situations<!-- by using a software system named <em>ParkMonitoringService</em> -->. </li>
</ul>

<div class="remark">
The job of our company is to design, build and deploy the  <em>ParkManagerService</em>.
</div>

<h2>Requirements</h2>
 
<div class="remark">
The <tt>ParkManagerService</tt>  should create the <tt>ParkServiceGUI</tt> (for the client) 
and the <tt>ParkServiceStatusGUI</tt> (for the manager) and then perform the following tasks:


<ul>
 
<li><hr/>
<em>acceptIN</em>: accept the request of a client to park the car if there is at least one <tt>parking-slot</tt> available,
select a free slot identified with a unique <tt>SLOTNUM</tt>.<br/>
A request of this type can be elaborated only when the <k><tt>INDOOR-area</tt> is free</k>, 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager). 
If the <tt>INDOOR-area</tt> is already engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice). 
<br/>
  <li><em>informIN</em>: inform the client about the value of the <tt>SLOTNUM</tt>.</li> 
If  <k>SLOTNUM>0</k>:
  <ol>
   <li><em>moveToIn</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>INDOOR</tt> ;</li>
  <li><em>receipt</em>: send to the client a receipt including the value of the <tt>TOKENID</tt> ;</li> 
  <li><em>moveToSlotIn</em>: move the <tt>transport trolley</tt> from the <tt>INDOOR</tt> to the selected <tt>parking-slot</tt>;</li>
  <!-- <li>accept another request (<tt>acceptIN</tt> or <tt>acceptOUT</tt>). -->
  <li><em>backToHome</em>: if no other request is present,  move the <tt>transport trolley</tt> to its <tt>home</tt> location,
  else <em>acceptIN</em> or <em>acceptOUT</em>.</li> 
  </ol>
 </li>
If <k>SLOTNUM==0</k>: 
	<ul>
	<li><em>moveToHome</em>: if not already at home, move the <tt>transport trolley</tt> to its <tt>home</tt> location.</li> 
	</ul>
</li>


<li><hr/>
<em>acceptOUT</em>: accept the request of a client to get out the car with <tt>TOKENID</tt>.
A request of this type can be elaborated only when the <k><tt>OUTDOOR-area</tt> is free</k> 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager).
If the <tt>OUTDOOR-area</tt> is still engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice).

	<ol>
	<li><em>findSlot</em>: deduce the number of the parking slot (<em>CARSLOTNUM</em>) from the <tt>TOKENID</tt>;</li>
	<li><em>moveToSlotOut</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>CARSLOTNUM/parking-slot</tt> ;</li>
	<li><em>moveToOut</em>: move the <tt>transport trolley</tt> to the <tt>OUTDOOR</tt> ;</li>
	<li><em>moveToHome</em>: if no other request is present  move the <tt>transport trolley</tt> to its <tt>home</tt> location; <br/>
	else <em>acceptIN</em> or <em>acceptOUT</em></li> 

	</ol> 
</li>
<li>
<hr/>
<em>monitor</em>: update the <tt>ParkServiceStatusGUI</tt> with the required information about the state of the system.
</li>

<li>
<hr/>
<em>manage</em>: accept the request of the manager to stop/resume the behavior of the  <tt>transport trolley</tt>.
</li>

</ul>
<h4>About the devices</h4>
All the sensors (<tt>weigthsensor</tt>, <tt>outsonar</tt>, <tt>thermometer</tt> ) and the <tt>fan</tt> should be properly simulated
by mock-objects or mock-actors.

<h4>When using a real robot</h4>
No further requirement.

<h4>When available a Raspberry and a sonar</h4>
The <tt>outsonar</tt> could be a real device. We can simulate the presence/absence of a car.

    <h4>When using <k>only</k> the virtual robot or <k>no real sonar</k> available</h4>
Consider the new requirement:
<ul>
<li><ks>authorize</ks>: allow a manager to use the <tt>ParkServiceStatusGUI</tt> only if she/he owns <bc>proper permissions</bc>.</li>
 
</ul>

<h3>User stories</h3>
As a <bc>client - parking phase</bc> :
<ul>
<li>I intend to use a <em>ParkServiceGUI</em> provided by the <tt>ParkManagerService</tt>  to notify my interest in <i>entering</i> 
my auto in the <tt>parking-area</tt> and to receive as answer the number <em>SLOTNUM</em> of a  free parking-slot  (<tt>1&lt;=SLOTNUM&lt;=6</tt>). 
<tt>SLOTNUM<k>==0</k></tt> means that no free slot is available.</em>

</li>
<li>If <tt>SLOTNUM <k>>0</k></tt>, I move my car in front to the <tt>INDOOR</tt>, get out of the car and afterwards press a <em>CARENTER</em> button on the
<em>ParkServiceGUI</em>. Afterwards, the <tt>transport trolley</tt> takes over my car and moves it from the <tt>INDOOR</tt> 
to the selected <tt>parking-slot</tt>.
The <tt>ParkServiceGUI</tt> will show to me a receipt that includes a (unique) <em>TOKENID</em>, 
to be used in the <i>car pick up</i> phase.</li>
</ul>

As a <bc>client - car pick up phase</bc> :
<ul>
<li>I intend to use the <tt>ParkServiceGUI</tt> to submit the request to pick up my car, by sending the <tt>TOKENID</tt> previously received. </li>  
<li>Afterwards, the <tt>transport trolley</tt>  takes over my car and moves it from its <tt>parking-slot</tt> to the <tt>OUTDOOR-area</tt>.</li>
<li>I move the car, so to free the <tt>OUTDOOR-area</tt>.
</li>
 </ul>

As a <bc>parking-manager</bc>:
<ul>
<li>I intend to use the <em>ParkServiceStatusGUI</em>  provided by the <tt>ParkManagerService</tt>
to observe the <em>current state</em> of the <tt>parking area</tt>, including the value <tt>TA</tt> of the temperature,
the state of the <tt>fan</tt> and the state of the <tt>transport trolley</tt> (<k>idle, working or stopped</k>).</li>
<li>I intend to <em>stop</em> the <tt>transport trolley</tt> when <k>TA > TMAX</k>, activate the <tt>fan</tt> and 
wait until <k>TA &lt; TMAX</k>. At this time, I stop the <tt>fan</tt> and resume the behavior of the <tt>transport trolley</tt>.
Hopefully, the <b>start/stop</b> <ks>of the fan</ks> could also be automated by the <tt>ParkManagerService</tt>,
while the <b>start/stop</b> <ks>of the transport trolley</ks> is always up to me.
</li>

<li>I expect that the <tt>ParkManagerService</tt> sends to me an <em>alarm</em> if it detectes that the <tt>OUTDOOR-area</tt>
has not been cleaned within the <tt>DTFREE</tt> interval of time.</li>
</ul>

</div>

 

<h2>Requirement analysis</h2>
Result of the previous <k>SPRINT</k> Analysis
  <table style="width:100%" border="1">
		<tr>
			<td rowspan="2" style="width:80%">
			 <img src="img\LogicalArchitecture.png" width="100%">
			<td>
				<a href="../../../../SPRINT0/modello/it.unibo.ParkManagerService/src/park_service_model_0.qak">Model SPRINT0</a>
			</td>
			<tr>
				<td><a href="../../../../SPRINT0/modello/it.unibo.ParkManagerService/src/test/TestPlanUseCase1.kt">TestPlanUseCase1.kt</a></td>
			</tr>
		</tr>
  </table>
 <br>
 <br>
 In this <k>SPRINT</k> we will include the <em>outsonar</em> and we will expand the parking slots from one to six spots. We will not consider any other elements (<tt>ParkServiceGUI</tt>, <tt>ParkServiceStatusGUI</tt>, <tt>parking-manager</tt>, <tt>fan</tt>, <tt>thermometer</tt>).
 <br>
 We are updating the previous work (see the <a href="../../SPRINT0/it.unibo.ParkManagerService/uderDocs/parkManagerService_0_c">documentation</a>) to handle a higher amount of clients and to complete the <em>acceptOUT</em> requirement, 
 this will allow us to maintain the focus on the core of the application, while also being able to handle a more complex situation, without introducing too many different elements.
 <br>
 <br>
 At the end of the <k>SPRINT</k> at least six clients should be able to successfully park and exit. 
 Also, the system should be able to reject any client's parking request if every slot is occupied.
 </div>
 <br>
 Note: optional parts will not be discussed at this stage and will be implemented at the end.
 <br>
 <br>
 In this <k>SPRINT</k> we will consider only the following use-cases:
 <h4>Use-case <ks>(at least) one parking slot is empty</ks></h4>
 The application should be able, in order, to: 
 <br>
 <ol>
	<li>Receive a parking request from a client.</li>
	<li>Check the availability of the slot and if the <em>INDOOR-area</em> is free.</li> 
	<li>Send the client the value of the <tt>SLOTNUM</tt>.</li>
	<li>Receive the intention to enter the car from the client.</li>
	<li>Move the transport trolley.</li>
	<li>Send the client the <tt>TOKENID</tt>.</li>
	<li>Move the trolley <tt>home</tt>.</li>
	<li>Receive a pick-up request from the client with his <tt>TOKENID</tt>.</li>
	<li>Obtain the parking slot from <tt>TOKENID</tt>.</li>
	<li>Check if the <em>OUTDOOR-area</em> is free.</li>
	<li>Move the trolley to pick up the car.</li>
	<li>Move the trolley to the <em>OUTDOOR-area</em>.</li>
	<li>Move the trolley <tt>home</tt>.</li>
 </ol>
 <h4>Use-case <ks>every parking slots is already occupied</ks></h4>
 The application should be able, in order, to: 
 <br>
 <ol>
	<li>Receive a parking request from a client.</li>
	<li>Check the availability of the slot and if the <em>INDOOR-area</em> is free, but the slot is occupied.</li>
	<li>Send the client a message of <tt>SLOTNUM</tt>=0.</li>
	<li>Move the trolley home.</li>
 </ol>

<h2>Problem analysis</h2>

As stated in the previous <k>SPRINT</k>, this problem requires the communications of different components in a distributed environment, see <a href="../../../../SPRINT0/modello/it.unibo.ParkManagerService/userDocs/parkManagerService_0_c.html#problemanalysis">SPRINT0 | problem analysis</a>. And, following the reasoning already made, we will add the <em>outsonar</em> as a QakActor to the already existing architecture.

	<h3>A new component: <b><tt>Sonar-sensor resource</tt></b></h3>
	We need to add a new component: <tt>Sonar-sensor resource</tt>.
	<br>
	<tt>Sonar-sensor resource</tt> receives data from the <em>outsonar</em>, which means that it must store the information regarding the <em>OUTDOOR-area</em> and makes them available to the other entities in the system.
	<br><br>
	This component is similar to the <tt>weightsensor</tt> already introduced, and as already observed the best way to realize it is to have an observable resource, see <a href="../../../../SPRINT0/modello/it.unibo.ParkManagerService/userDocs/parkManagerService_0_c.html#weightsensor">SPRINT0 | Weight-sensor-resource</a>. 
	In particular, we can define <tt>Sonar-sensor resource</tt> as a <k>CoAp</k> observable actor and the <tt>ParkmanagerService</tt> as an observer. 
	<br>
	<br>
	Because we are interested only if a car is present or not, we don't need to memorize the car distance, but we can use a symbolic string such as "free" and "occupied". The change of the value of the <k>CoAp</k> observable state should be done only if the distance changes significantly.
	Let's consider a fixed value delta. If the <k>| previous value - the current value | > delta</k>, then we change it.
	<br><br>
	A mock of the sonar is required to simulate the real sensor. The decision around the nature of the mock itself is left during the project phase.
	 
 <h3>Other relevant aspects</h3>
 
 <h4>Assign a slot to a client</h4>
 We need to find the best way to assign a parking slot to an incoming car. There are different methods: 
 <br>
 (<b>Note</b>: when we refer to near or close we mean based on the distance calculated in  <a href="https://en.wikipedia.org/wiki/Taxicab_geometry" target="web">Manhattan distance</a> without considering the squares occupied by the parking slots).
 <br>
 <table style="width:100%" border="1">
		<tr>
			<td style="width:50%">
			<ks>First free spot in increasing order</ks>		
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Easy to realize.</dd>
					<dt><k>Cons</k>:</dt> 
					<dd>Not always the optimal/most convenient choice.</dd>
				</dl>
			</td>
			
		</tr>
		<tr>
			<td>
			<ks>Closest spot to the current robot position</ks>
			</td>
			<td>
				<dl>
				<dt><k><tt>Pro</tt></k>:</dt>
				<dd></dd>
				<dt><k>Cons</k>:</dt> 
				<dd>The robot position when the slot is requested maybe not be the same when the client request to enter.</dd>
				<dd>The robot always pick-up the car in the <tt>INDOOR</tt>, so the current robot position doesn't matter since the distance to park from the <tt>INDOOR</tt> would be the same.</dd>
				</dl>
			</td>
		</tr>
		<tr>
			<td>
			<ks>Prioritize the slot near the <tt>INDOOR</tt></ks>
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Prioritize shortest parking distance, meaning less waiting time for the next client.</dd>
					<dd>Also close to the <tt>HOME</tt> position.</dd>
					<dd>Cover the shortest distance if there are multiple succeeding requests to enter.</dd>
					<dt><k>Cons</k>:</dt>
					<dd>Furthest from the <tt>OUTDOOR</tt>, meaning longer waiting time for the exiting clients.</dd>
				</dl>
			</td>
		</tr>
		<tr>
			<td>
			<ks>Prioritize the slot near the <tt>OUTDOOR</tt></ks>
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Quickest way for a car to exit, meaning less waiting time for the client that requested to pick-up their car.</dd>
					<dt><k>Cons</k>:</dt>
					<dd>Furthest from the <tt>INDOOR</tt> and <tt>HOME</tt> position.</dd>
					<dd>Longer route to go back <tt>HOME</tt> if there are no other requests.</dd>
					<dd>Longer route to go <tt>INDOOR</tt> if there is a parking request.</dd>
					<dd>During the <tt>pick-up</tt> phase if the <tt>trolley </tt> is <tt>HOME</tt> the distance to reach the <tt>OUTDOOR</tt> would still be the same using the other methods.</dd>
				</dl>
			</td>
		</tr>
		<tr>
			<td>
			<ks>Prioritize the slot near the <tt>HOME</tt></ks>
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Shortest path for the trolley to return <tt>HOME</tt> if there are no pending requests.</dd>
					<dd>Close enough from the <tt>INDOOR</tt> to have the same benefit from prioritizing the position near it.</dd>
					<dt><k>Cons</k>:</dt>
					<dd>Furthest from the <tt>OUTDOOR</tt>, meaning longer waiting time for the exiting clients..</dd>
				</dl>
			</td>
		</tr>
	</table>
	<br>
	We would not advise choosing the option <ks>near the <tt>OUTDOOR-area</tt></ks> because the <tt>trolley</tt> needs to travel the longest path from/to <tt>HOME</tt>.
	The preferred approach would be to choose the slot <ks>closest to the <tt>HOME</tt></ks> position, because assuming that the robot will return often <tt>HOME</tt> make sense to
	keep it close to walk less distance, while also being close enough to the <tt>INDOOR</tt>.<br>
	If we considered the slot number numbered like:
	<pre>
|r, 0, 0, 0, 0, 0, 0, X, 
|0, 0, <bc>1,</bc> <bc>2,</bc> 0, 0, 0, X, 
|0, 0, <bc>3,</bc> <bc>4,</bc> 0, 0, 0, X, 
|0, 0, <bc>5,</bc> <bc>6,</bc> 0, 0, 0, X, 
|0, 0, 0, 0, 0, 0, 0, X, 
|X, X, X, X, X, X, X, X, 
	</pre>
	To do so we could assign the slot in this order: 1,2,3,5,4,6.
	<br>
	It would be convenient to assign a <ks>priority</ks> number, so that the smallest number has the highest priority, simplifyfing the prolog logic to choose the parking slot.
	<br>
	Also if one method turns out to be preferred over the others we could easily change the parking slot priority assigned and not the Prolog logic. 
	<br>
    <ks>For example</ks>, if the request traffic from the clients is higher than expected and the trolley rarely goes <tt>HOME</tt> we can easily change it to prioritize the slot near the <tt>INDOOR</tt>.
	<br>
	<br>
	Parking slot <ks>priority</ks> showed on the map:
	<pre>
|r, 0, 0, 0, 0, 0, 0, X, 
|0, 0, <bc>1,</bc> <bc>2,</bc>, 0, 0, 0, X, 
|0, 0, <bc>3,</bc> <bc>5,</bc>, 0, 0, 0, X, 
|0, 0, <bc>4,</bc> <bc>6,</bc>, 0, 0, 0, X, 
|0, 0, 0, 0, 0, 0, 0, X, 
|X, X, X, X, X, X, X, X, 
	</pre>
  Since the requirements don't impose any particular restriction on the parking numbering we can decide that, at the moment, every slot number has the same as their respective <ks>priority</ks>.
  The prolog knowledge-base can be easily modified to implement these changes.
 <h3>Logical architecture</h3>
 <table style="width:100%" border="1">
		<tr>
			<td rowspan="2" style="width:80%">
			 <img src="img/LogicalArchitecture_1.png" width="100%">
			<td>
				<a href="../src/park_service_model_1.qak">Model SPRINT1</a>
			</td>
			<tr>
				<td><a href="../src/test/TestPlanUseCase1.kt">TestPlanUseCase1.kt</a></td>
			</tr>
		</tr>
  </table>
 <br>
 <k>See here the <a href="img\legenda.png" target="img">Legenda</a>.</k>
 <!--
	<li>(Currently an open point) How does the <tt>ParkManagerService</tt> makes sure that during the client interaction between the request to enter and the carenter message, the slot is given to the same client?
	A client could receive the SLOTNUM, then not send a carenter. 
	<br>
	At the moment is assumed that the client always sends a carenter request, so the system keeps the slot occupied after the first request to park. 
	</li>
 -->
 <br>
 <h3>Expected Time</h3>
 Starting from the model already built, the first protoype is expected to be developed in 1 day of work.
 <br>
 
<h2>Test plans</h2> 

<h4>Use-case <ks>(at least) one parking slot is empty</ks></h4>
 We can generate a <k>N</k> number of clients that request to park and, after receiving the receipt, to exit the parking slot.
<br> 
 To check if the test is successful we need to observe the trolley movement and the message exchange between the application and the client.
 <br><br>
 Requirements: <em>AcceptIN</em>, <em>informIN</em>, <em>moveToIN</em>, <em>receipt</em>, <em>moveToSlotIN</em>, <em>backToHome</em>, <em>AcceptOUT</em>, <em>findSlot</em>, 
 <em>moveToSlotOut</em>, <em>moveToOut</em>, <em>moveToHome</em>.
 <br><br>
 <ks>Starting conditions:</ks>
 <ul>
	<li><em>INDOOR-area</em> is free.</li>
	<li><em>OUTDOOR-area</em> is free.</li>
	<li><tt>Transport Trolley</tt> is <em>home</em> (not stopped).</li>
	<li>The parking slots are not occupied.</li>
 </ul>
 We expect, for each client, that:
 <ol>
	<li><tt>SLOTNUM</tt> value is always from 1 to 6.</li>
	<li><tt>TOKENID</tt> is from 10 to X<k>N</k>, where X is any number between 1 and 6.</li>
	<li>The robot moved <k>N</k> times to the <em>INDOOR-area</em> and <k>N</k> times to the <em>OUTDOOR-area</em></li>
 </ol> 
 
 
 </ol>
 <p>JUnit test: <a href="../src/test/TestPlanUseCase1.kt">TestPlanUseCase1.kt</a>, <a href="../src/test/TestPlanUseCase1RobotPos.kt">TestPlanUseCase1RobotPos.kt</a>
 <br>
 <h4>Use-case <ks>every parking slot is already occupied</ks></h4>
  We can generate a <k>N</k> number of clients request to park, and for each the service refuse. 
  To check if the test is successful we need to observe the message exchange between the application and the client.
  <br><br>
   Requirements: <em>AcceptIN</em>, <em>informIN</em>.
 <br><br>
  <ks>Starting conditions:</ks>
  <ul>
	<li><em>INDOOR-area</em> is free.</li>
	<li><em>OUTDOOR-area</em> is free.</li>
	<li><tt>Transport Trolley</tt> is <em>home</em> (not stopped).</li>
	<li>Every parking slot is occupied.</li>
  </ul>
 
 We expect, for each client, that:
 <ol>
	<li><tt>SLOTNUM</tt> value is 0 for all the <k>N</k> clients.</li>
 </ol> 
 <p>JUnit test: <a href="../src/test/TestPlanUseCase2.kt">TestPlanUseCase2.kt</a></p>



<h2>Project</h2>
<h3>Concrete architecture</h3>
<img src="img\ConcreteArchitecture_1.png"  width="100%">
<h3>Components</h3>
 The application-logic of the model developed in the analysis phase can be adopted unchanged in the project-phase. Although the application code is the same we moved some actors 
 to different contexts; so they can be deployed in the distributed environment over separate computational nodes.
 <br>
 <br>
 Follow an explanation on the only components that have been changed/added since the previous <k>SPRINT</k>.
 <br>
 <h4>Sonarsensor</h4>
 <table style="width:100%" border="1">
	<tr>
		<td style="width:30%">
			<center><img src="img\SonarActor.png"></center>
			<br>
			<div class="remark">
			As stated in the analysis it changes the CoAP-observable state with the String: "<b>free</b>" or "<b>occupied</b>".
			<br><br>
			The inital state is set to "<b>free</b>".
			</div>
		</td>
		<td>
			<ol>
				<li>The model introduced in the analysis phase can be adopted also as our <tt>sonarsensor</tt> component in the project phase, see <a href="../../../progetto/it.unibo.Sonarsensor/src/sonarsensor.qak">sonarsensor.qak</a>.</li>
				<li>A mock has been developed in python file: <a href="../pythonMocks/sonarSensorMockTCP.ipynb">sonarSensorMockTCP.ipynb</a> uses TCP to send the data to the sensor and a graphic interface that allow typing in the next value.</li> 
		</td>
	</tr>
	</table>
	<br>
	<h4>ParkManagerService</h4>
 <table style="width:100%" border="1">
	<tr>
		<td style="width:30%">
			<center><img src="img\PMSActor_1.png"></center>
		</td>
		<td>
			<ol>
				<li>The model introduced in the analysis phase can be adopted also as our <tt>parkmanager</tt> component in the project phase, see <a href="../../../progetto/it.unibo.parkManagerTrolley/src/parkmanager.qak">parkmanager.qak</a>.</li>
				<li>We changed the prolog logic and added the facts about the new slots. We updated the method to return a free parking slot as discussed, 
				retrieving the min number from the free parking slot, see <a href="../parking.pl">parking.pl</a>.</li>
				<li>As already done with the <tt>weightsensor</tt>, to observe the <tt>sonarsensor</tt> without interfering with the execution of the <tt>parkmanagerservice</tt> we need to introduce proper support. So we added a new actor: <a href="..\src\coap\actorQakSonarCoapObserver.kt">actorQakSonarCoapObserver.kt</a>.
				Which can observe <tt>sonarsensor</tt> and can receive and memorize the data. Then <tt>parkmanagerservice</tt> can retrieve the information about the <em>OUTDOOR-area</em> only when it needs to elaborate the parking request.</li>
		</td>
	</tr>
	</table>

<h2>Testing</h2> 
 We performed a <em>Non-distributed</em> testing. All the components are deployed in the same PC and are in the same context.
 <br>
 In the following tests we only checked if the code meet the set of requirement imposed by the <kt>Use-cases</kt>.
 Also note that the tests have been executed using only the <ks>virtual robot</ks>.
 <h3>Test execution</h3>
 <table style="width:100%" border="1">
	<tr>
		<td style="width:50%">
			<center><img src="img\testPlan1.png" width="80%" height="80%"></center>
		</td>
		<td>
			Test <a href="../src/test/TestPlanUseCase1.kt">TestPlanUseCase1.kt</a> to occupy every parking slot completed successfully.
			Six clients requested to park and the system returned <tt>SLOTNUM</tt> from 1 to 6 and generated the expected <tt>TOKENID</tt>: 10, 21, 32 ,43, 54, 65
		</td>
	</tr>
	<tr>
		<td style="width:50%">
			<center><img src="img\testPlan1Robot.png" width="80%" height="80%"></center>
		</td>
		<td>
			Test <a href="../src/test/TestPlanUseCase1RobotPos.kt">TestPlanUseCase1RobotPos.kt</a> to check the <tt>trolley</tt> position when parking <k>N</k> clents completed successfully.
			The system moved the trolley to the <tt>indoor</tt> and <tt>outdoor</tt> position exactly <k>N</k> times.
		</td>
	</tr>
	<tr>
		<td style="width:50%">
			<center><img src="img\testPlan2.png" width="80%" height="80%"></center>
		</td>
		<td>
			Test <a href="../src/test/TestPlanUseCase2.kt">TestPlanUseCase1.kt</a> to refuse <k>N</k> clients to park completed successfully.
			The system responded with a <tt>SLOTNUM</tt> of value 0 to the <k>N</k> simulated clients request to park.
		</td>
	</tr>
</table>

<h2>Deployment</h2> 

 
<h2>Maintenance</h2> 
 
<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white;overflow: auto">
By Emanuele Paci email: emanuele.paci@studio.unibo.it
<br/>
Repository: https://github.com/empaci/Paci-Emanuele-Progetto-Finale-ISS2021
<img src="img\fototessera.png" alt="foto" width="15%" height="15%" style="float:right;">
</div> 
</body>
</html>