<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>parkManagerService_0</title></head>
    
<body>
<div id="top">
<h1>LABORATORIO DI INGEGNERIA DEI SISTEMI SOFTWARE <font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
 
A company intends to build an <i>automating parking service</i> composed of a set of elements:

<ul>
<li>A software system, named <em>ParkManagerService</em>, that implements the required automation functions.</li>
<li>A <tt>DDR</tt> robot working as a <em>transport trolley</em>, that is intially situated in its <em>home</em> location. 
The <tt>transport trolley</tt> has the form of a square of side length <em>RD</em>.
</li>
<li>A <em>parking-area</em> is an empty room that includes;
	<ul>
	<li>an <em>INDOOR</em> to enter the car in the area. Facing the <tt>INDOOR</tt>, there is
	a <em>INDOOR-area</em> equipped with a <em>weigthsensor</em> that measures the <em>weigth</em> of the car;</li>
	<li>an <em>OUTDOOR</em> to exit from the <tt>parking-area</tt>. Just after the <tt>OUTDOOR</tt>, there is
	<em>OUTDOOR-area</em> equipped with a <em>outsonar</em>, used to detect the presence of a car.
	The <tt>OUTDOOR-area</tt>, once engaded by a car, should be freed within a prefixed interval of time <em>DTFREE</em>; </li>
	<li>a number <tt>N (N=6)</tt> of <em>parking-slots</em>;</li>
	<li>a <em>thermometer</em> that measures the temperature <em>TA</em> of the area;</li>
	<li>a <em>fan</em> that should be activated when <k>TA > TMAX</k>, where <em>TMAX</em> is a prefixed value (e.g. <tt>35</tt>)</li>
	</ul>
	A <em>map</em> of the parking area, represented as a grid of squares of side length <em>RD</em>, 
	is available in the file <a href="parkingMap.txt" target="code">parkingMap.txt</a>:
	<pre>
|r, 0, 0, 0, 0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, <bc>X, X,</bc>  0, 0, 0, X, 
|0, 0, 0, 0, 0, 0, 0, X, 
|X, X, X, X, X, X, X, X, </pre>
	The map includes the positions of the  <tt>parking-slots</tt> (marked above with the symbol <k>X</k>) 
	and of the <em>fixed obstacles</em> in the area (the walls marked with the symbol <b>X</b>).
	<br/><br/>
	The area marked with <k>X</k> is a sort of 'equipped area' upon which the <tt>transport trolley</tt> cannot walk.
	Thus, to get the car in the <tt>parking-slot</tt> <ks>(2,2)</ks>, the <tt>transport trolley</tt> must
	go in cell <ks>(1,2)</ks>.
	<br/><br/>

	The proper scene for the WEnv is reported in: <a href="parkingAreaConfig.js" target="code">parkingAreaConfig.js</a>
 
	
	<center><img src="./img/parkingAreaZone.PNG" alt="parkingAreaZone.PNG" width="45%" height="32%"/></center>
</li>	
<li>a <em>parking-manager</em> (an human being) which supervises the state of the <tt>parking-area</tt>
and handles critical situations<!-- by using a software system named <em>ParkMonitoringService</em> -->. </li>
</ul>

<div class="remark">
The job of our company is to design, build and deploy the  <em>ParkManagerService</em>.
</div>

<h2>Requirements</h2>
 
<div class="remark">
The <tt>ParkManagerService</tt>  should create the <tt>ParkServiceGUI</tt> (for the client) 
and the <tt>ParkServiceStatusGUI</tt> (for the manager) and then perform the following tasks:


<ul>
 
<li><hr/>
<em>acceptIN</em>: accept the request of a client to park the car if there is at least one <tt>parking-slot</tt> available,
select a free slot identified with a unique <tt>SLOTNUM</tt>.<br/>
A request of this type can be elaborated only when the <k><tt>INDOOR-area</tt> is free</k>, 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager). 
If the <tt>INDOOR-area</tt> is already engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice). 
<br/>
  <li><em>informIN</em>: inform the client about the value of the <tt>SLOTNUM</tt>.</li> 
If  <k>SLOTNUM>0</k>:
  <ol>
   <li><em>moveToIn</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>INDOOR</tt> ;</li>
  <li><em>receipt</em>: send to the client a receipt including the value of the <tt>TOKENID</tt> ;</li> 
  <li><em>moveToSlotIn</em>: move the <tt>transport trolley</tt> from the <tt>INDOOR</tt> to the selected <tt>parking-slot</tt>;</li>
  <!-- <li>accept another request (<tt>acceptIN</tt> or <tt>acceptOUT</tt>). -->
  <li><em>backToHome</em>: if no other request is present,  move the <tt>transport trolley</tt> to its <tt>home</tt> location,
  else <em>acceptIN</em> or <em>acceptOUT</em>.</li> 
  </ol>
 </li>
If <k>SLOTNUM==0</k>: 
	<ul>
	<li><em>moveToHome</em>: if not already at home, move the <tt>transport trolley</tt> to its <tt>home</tt> location.</li> 
	</ul>
</li>


<li><hr/>
<em>acceptOUT</em>: accept the request of a client to get out the car with <tt>TOKENID</tt>.
A request of this type can be elaborated only when the <k><tt>OUTDOOR-area</tt> is free</k> 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager).
If the <tt>OUTDOOR-area</tt> is still engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice).

	<ol>
	<li><em>findSlot</em>: deduce the number of the parking slot (<em>CARSLOTNUM</em>) from the <tt>TOKENID</tt>;</li>
	<li><em>moveToSlotOut</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>CARSLOTNUM/parking-slot</tt> ;</li>
	<li><em>moveToOut</em>: move the <tt>transport trolley</tt> to the <tt>OUTDOOR</tt> ;</li>
	<li><em>moveToHome</em>: if no other request is present  move the <tt>transport trolley</tt> to its <tt>home</tt> location; <br/>
	else <em>acceptIN</em> or <em>acceptOUT</em></li> 

	</ol> 
</li>
<li>
<hr/>
<em>monitor</em>: update the <tt>ParkServiceStatusGUI</tt> with the required information about the state of the system.
</li>

<li>
<hr/>
<em>manage</em>: accept the request of the manager to stop/resume the behavior of the  <tt>transport trolley</tt>.
</li>

</ul>
<h4>About the devices</h4>
All the sensors (<tt>weigthsensor</tt>, <tt>outsonar</tt>, <tt>thermometer</tt> ) and the <tt>fan</tt> should be properly simulated
by mock-objects or mock-actors.

<h4>When using a real robot</h4>
No further requirement.

<h4>When available a Raspberry and a sonar</h4>
The <tt>outsonar</tt> could be a real device. We can simulate the presence/absence of a car.

    <h4>When using <k>only</k> the virtual robot or <k>no real sonar</k> available</h4>
Consider the new requirement:
<ul>
<li><ks>authorize</ks>: allow a manager to use the <tt>ParkServiceStatusGUI</tt> only if she/he owns <bc>proper permissions</bc>.</li>
 
</ul>

<h3>User stories</h3>
As a <bc>client - parking phase</bc> :
<ul>
<li>I intend to use a <em>ParkServiceGUI</em> provided by the <tt>ParkManagerService</tt>  to notify my interest in <i>entering</i> 
my auto in the <tt>parking-area</tt> and to receive as answer the number <em>SLOTNUM</em> of a  free parking-slot  (<tt>1&lt;=SLOTNUM&lt;=6</tt>). 
<tt>SLOTNUM<k>==0</k></tt> means that no free slot is available.</em>

</li>
<li>If <tt>SLOTNUM <k>>0</k></tt>, I move my car in front to the <tt>INDOOR</tt>, get out of the car and afterwards press a <em>CARENTER</em> button on the
<em>ParkServiceGUI</em>. Afterwards, the <tt>transport trolley</tt> takes over my car and moves it from the <tt>INDOOR</tt> 
to the selected <tt>parking-slot</tt>.
The <tt>ParkServiceGUI</tt> will show to me a receipt that includes a (unique) <em>TOKENID</em>, 
to be used in the <i>car pick up</i> phase.</li>
</ul>

As a <bc>client - car pick up phase</bc> :
<ul>
<li>I intend to use the <tt>ParkServiceGUI</tt> to submit the request to pick up my car, by sending the <tt>TOKENID</tt> previously received. </li>  
<li>Afterwards, the <tt>transport trolley</tt>  takes over my car and moves it from its <tt>parking-slot</tt> to the <tt>OUTDOOR-area</tt>.</li>
<li>I move the car, so to free the <tt>OUTDOOR-area</tt>.
</li>
 </ul>

As a <bc>parking-manager</bc>:
<ul>
<li>I intend to use the <em>ParkServiceStatusGUI</em>  provided by the <tt>ParkManagerService</tt>
to observe the <em>current state</em> of the <tt>parking area</tt>, including the value <tt>TA</tt> of the temperature,
the state of the <tt>fan</tt> and the state of the <tt>transport trolley</tt> (<k>idle, working or stopped</k>).</li>
<li>I intend to <em>stop</em> the <tt>transport trolley</tt> when <k>TA > TMAX</k>, activate the <tt>fan</tt> and 
wait until <k>TA &lt; TMAX</k>. At this time, I stop the <tt>fan</tt> and resume the behavior of the <tt>transport trolley</tt>.
Hopefully, the <b>start/stop</b> <ks>of the fan</ks> could also be automated by the <tt>ParkManagerService</tt>,
while the <b>start/stop</b> <ks>of the transport trolley</ks> is always up to me.
</li>

<li>I expect that the <tt>ParkManagerService</tt> sends to me an <em>alarm</em> if it detectes that the <tt>OUTDOOR-area</tt>
has not been cleaned within the <tt>DTFREE</tt> interval of time.</li>
</ul>
</div>

<h2>Requirement analysis</h2>
 
 In this SPRINT is considered only one parking spot and the <em>weightsensor</em> and no other elements (<tt>outsonar</tt>, <tt>ParkServiceGUI</tt>, <tt>ParkServiceStatusGUI</tt>, <tt>parking-manager</tt>, <tt>fan</tt>, <tt>thermometer</tt>).
 We are cnsidering an easier problem to focus on the core elements of the application.
 <br>
 At the end of the <k>SPRINT</k> a client should be able to successfully park and exit. 
 Also, the system should be able to reject a client's parking request if the slot is occupied.
 <br>
 </div>
<div style="background-color: #f0e1ff;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;">
  <h3><b>Summary of the first SPRINT-review meeting</b></h3>
 The main results of the SPRINT-review meeting can be summarized as follow:
 <ol>
	<li>Add <em>carenter</em> botton.</li>
	<li>Consider the parking state as an object.</li>
	<li>Add a functioning model and test as code.</li>
	<li>Use basicrobotactor for the trolley(?).</li>
	<li>Clarifications about the GUI.</li>
	<li>Why using qak is also a model, that is understandable by the client, testable and functoning.</li>
	<li>How the sensor are in the system reality.</li>
	<li>Trolley positioning.</li>
 </ol>
</div>
 <br>
 Note: optional parts will not be discussed at this stage and will be implemented at the end.
 <br>
 <br>
 The client clarified on the first exchange on 03/06/2021 that the trolley takes the car on himself, in a way that he occupies a single square on the grid.
 Also, the <em>transport trolley</em> cannot go over the parking area even if empty, so the parking slot will be represented as an obstacle.
 <br>
 <br>
 Other terms to clarify:
 <ul>
	<li><ks>DDR robot</ks>: entity capable of moving and able to communicate through the network. It can be simulated by our virtual robot, see the following documentation <a href="../it.unibo.virtualRobot2020/VirtualRobot2021.html" target="web">VirtualRobot2021.html</a>.</li>
	<li><ks>Car</ks>:  motor vehicle used for transportation with four wheels.</li>
	<li><ks>Weight sensor</ks>: device that converts an input mechanical force such as load, weight, compression, or pressure into an electrical output signal that can be measured.</li>
	<li><ks>Outsosnar</ks>: device that uses sound propagation to detect object presence.</li>
	<li><ks>Thermomether</ks>: device that measure temperature.</li>
	<li><ks>Fan</ks>: machine for producing airflow, used for cooling the room.</li>
	<li><ks>Critical situations</ks>: dangerous situations that could cause damage to the system.</li>
 </ul>
 
 <br>
 The problem required to develop a distribuited system. Also our application must interact with the <a href="../../it.unibo.boundaryWalk/userDocs/VirtualRobot2021.html" target="web">VirtualRobot</a> provided by the costumer.
 <br>
  <br>
  <table style="width:60%" border="1">
		<tr>
			<td style="width:20%">
			Semplified Map considered: 		
			</td>
			<td>
				<pre>
					|r, 0, 0, 0, 0, 0, 0, X, 
					|0, 0, <bc>X,</bc> 0, 0, 0, 0, X, 
					|0, 0, 0, 0, 0, 0, 0, X, 
					|0, 0, 0, 0, 0, 0, 0, X, 
					|0, 0, 0, 0, 0, 0, 0, X, 
					|X, X, X, X, X, X, X, X, 
				</pre>
			</td>
		</tr>
  </table>
 <br>
 <br>
 In this <k>SPRINT</k> we will consider only the following use-cases:
 <h4>Use-case <ks>the parking slot is empty</ks></h4>
 The application should be able, in order, to: 
 <br>
 <ol>
	<li>Receive a parking request from a client.</li>
	<li>Check the availability of the slot and if the <em>INDOOR-area</em> is free.</li> 
	<li>Send the client the value of the <tt>SLOTNUM</tt>.</li>
	<li>Move the transport trolley.</li>
	<li>Send the client the <tt>TOKENID</tt>.</li>
	<li>Move the trolley <tt>home</tt>.</li>
	<li>Receive a pick-up request from the client with his <tt>TOKENID</tt>.</li>
	<li>Obtain the parking slot from <tt>TOKENID</tt>.</li>
	<li>Move the trolley to pick up the car.</li>
	<li>Move the trolley to the <em>OUTDOOR-area</em>.</li>
	<li>Move the trolley <tt>home</tt>.</li>
 </ol>
 <h4>Use-case <ks>the parking slot is already occupied</ks></h4>
 The application should be able, in order, to: 
 <br>
 <ol>
	<li>Receive a parking request from a client.</li>
	<li>Check the availability of the slot and if the <em>INDOOR-area</em> is free, but the slot is occupied.</li>
	<li>Send the client a message of <tt>SLOTNUM</tt>=0.</li>
	<li>Move the trolley home.</li>
 </ol>

<h2>Problem analysis</h2>
 
  This problem requires the communications of different components in a distributed environment.
  To do so let's consider the analysis made in <a href="../../it.unibo.raspIntro2020/userDocs/LabRadarGui.html" target="web">LabRadarGUI | Radar GUI as a service​</a> and <a href="../../it.unibo.raspIntro2020/userDocs/LabRadarGui.html" target="web">the relative SPRINT review</a>.
 <br>
 <br>
 Summary of the key points:
 <br>
	<table style="width:100%" border="1">
		<tr>
			<td style="width:50%">
			Direct communication between the resource and the application (Es. TCP) 		
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Easy to realize with existing support to close the abstraction gap.</dd>
					<dt><k>Cons</k>:</dt> 
					<dd>Code related to the application logic is not clearly separated from the code related to communication.</dd>
				    <dd>No layered structure of communication. </dd>
				    <dd>No separate input-handling. </dd>
				</dl>
			</td>
			
		</tr>
		<tr>
			<td>
			A middleware between the resource and the application (Es. MQTT)
			</td>
			<td>
				<dl>
				<dt><k><tt>Pro</tt></k>:</dt>
				<dd>Easy to realize with existing support to close the abstraction gap.</dd>
				<dt><k>Cons</k>:</dt> 
				<dd>Focus on low-level communication details.</dd>
				<dd>We still need to write code outside the components.</dd>
				</dl>
			</td>
		</tr>
		<tr>
			<td>
			Costum support
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Hide low-level communication and allows to focus on the logic and the behavior of each component.</dd>
					<dd>Allow thinking in high-level communication concepts (dispatch/request/event).</dd> 
					<dt><k>Cons</k>:</dt>
					<dd>Internal standard.</dd>
				</dl>
			</td>
		</tr>
	</table>
	<br>
	We will use <a href="../../it.unibo.qakactor/userDocs/LabQakIntro2021.html" target="web">QAkActor</a> or <a href="../../it.unibo.qakactor/src/main/kotlin/ActorBasic.kt" target="code">ActorBasic.kt</a>/<a href="../../it.unibo.qakactor/src/main/kotlin/ActorBasicFsm.kt" target="code">ActorBasicFsm.kt</a>, developed as a result of those studies, to model and realize our distributed components. 
	We will employ a top-down approach discussing only high-level communication concepts.
	<br>
 
 	<h3>Main components</h3>
	In the application we can identify 4 macro-components:
	<ul>
		<li><ks>ParkManagerService</ks>: the core of the application, used to interact with the client and control the trolley movement.</li>
		<li><ks>Client</ks>: used by the clients to communicate with the ParkManagerService.</li>
		<li><ks>Transport trolley</ks>: used to interact with the <tt>DDR</tt> robot.</li>
		<li><ks>Weight-sensor resource</ks>: a resource that receives, stores, and makes available the data from the weight-sensor.</li>
	</ul>
	 <h4>ParkManagerService</h4>
	  This component can:
	  <ul>
		<li>Listen to the <tt>Client</tt>'s requests and respond accordingly.</li>
		<li>Find a free parking slot if available.</li>
		<li>Based on the <tt>Client</tt>'s requests and the state of the system sends the <tt>Trolley</tt> the next action to perform.</li>
		<li>Keep track of the parking slots state.</li>
		<li>Generate <tt>TOKENID</tt>.</li>
		<li>Get information from the <tt>Weight-sensor resource</tt>.</li>
	  </ul>
	  There is no need to divide this component into simpler components since the complexity to coordinate them is greater than the complexity of the single one.  
	 <h4>Trolley</h4>
	 The <tt>Trolley</tt> is able to communicate to the <tt>DDR</tt> robot where to move in the grid, to do so the code already built in <a href="../../it.unibo.qakDemo/userDocs/LabQakDemo2021.html" target="web">it.unibo.qakDemo​</a> should be used. 
	 <br>
	 The <tt>Trolley</tt> doesn't need to have any application logic, it only needs the coordinates sent by the <tt>ParkManagerService</tt>.
	 <br>
	 <h4>Weight-sensor resource</h4>
	  <tt>Weight-sensor resource</tt> should be modeled as an observable resource, which stores the information regarding the <em>INDOOR-area</em>.
	  <br>
	  Based on the work done in <a>LabRadarGui | Radar GUI as a service</a> similar to the Sonar, we can define the Weightsensor resource as a CoAp observable actor and the <tt>ParkmanagerService</tt> as an observer.
	  <br>
	  We can use the qak actor because it already implements this feature.
	  <br>
	  <br>
	  Because we are interested only if a car is present or not, we don't need to memorize the weight of the car, but we can use a symbolic string such as "free" and "occupied".
	The change of the value of the CoAp-observable state should be done only if the weight change significantly. 
	<br>
	Let's consider a fixed value delta. If the <k>| previous value - the current value | > delta</k> then we change it.
	<br>
	<br>
	 A mock of the weight sensor is required to simulate the real sensor. The decision around the nature of the mock itself is left during the project phase.
	 <br>
	 <h4>Client</h4>
	 At the moment we can consider this as a mock of a real client, in the future this could be an intermediary between the GUI used by the client and the application. 
	 <br>
 
 
 <h3>Other relevant aspects</h3>
 
 <h4>Parking slot rapresentation</h4>
 The squares in the grid will be numbered starting from (0,0) in the top-left. 
 Some coordinates that need to be remembered:
 <ul>
	<li><ks>home</ks>: (0,0)</li>
	<li><ks>INDOOR-area</ks>: (6,0)</li>
	<li><ks>OUTDOOR-area</ks>: (6,4)</li>
	<li><ks>Parking slot</ks>: (3,1)</li>
  </ul>
  We need a consistent way to memorize this information and the slots that are occupied.
 To represent the state of the current parking slot, the "special" positions we could use different strategies:
 <br>
 <table style="width:100%" border="1">
		<tr>
			<td style="width:50%">
			Special coordinates are written as constant in the code, a structure to memorize the state of the parking 		
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Easy to realize.</dd>
					<dt><k>Cons</k>:</dt> 
					<dd>The data are not clearly separated from the code.</dd>
				    <dd>No permanent memory, if the system is rebooted we lose the current state of the parking.</dd>
				    <dd>Difficult to change. </dd>
				</dl>
			</td>
			
		</tr>
		<tr>
			<td>
			External file with the position of each parking and their state
			</td>
			<td>
				<dl>
				<dt><k><tt>Pro</tt></k>:</dt>
				<dd>Easy to maintain and more readable.</dd>
				<dd>Permanent memory.</dd>
				<dt><k>Cons</k>:</dt> 
				<dd>We need a standard to represent the data.</dd>
				<dd>We still need to write costum code to get the data.</dd>
				</dl>
			</td>
		</tr>
		<tr>
			<td>
			Prolog knowledge-base
			</td>
			<td>
				<dl>
					<dt><k><tt>Pro</tt></k>:</dt> 
					<dd>Already existing examples with qak actors, see <a href="../sonarguisprint/UserDocs/SonarResourceWebonSpring.html">SonarResourceWebonSpring.html | sonarguispring</a>.</dd>
					<dd>Could be build so that the Prolog interpreter, correctly inquired, could return a free-parking slot.</dd> 
					<dt><k>Cons</k>:</dt>
					<dd></dd>
				</dl>
			</td>
		</tr>
	</table>
	<br>
	In conclusion, a Prolog approach is preferred over the other methods.
 
 <h4>TokenID</h4>
 To make the <tt>TOKENID</tt> unique, but also easy to use and simple we can memorize the number of the slot occupied and sum an increasing number. 
	<br>
 We could reset the increment after reaching a certain number ex. 65535 to avoid any problem.
 
 <h3>Architecture logic</h3>
 
 <img src="img\LogicArchitecture.png">
 <br>
 <br>
 See here the <a href="img\legenda.png" target="img">Legenda</a>.
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <br>
 <h3>Interaction beween the ParkManagerService and the Client</h3>
 Schema of the messages between the <tt>ParkManagerService</tt> and the <tt>Client</tt> from the Use-case <ks>the parking slot is empty</ks>:
 <br>
 <table style="width:100%" border="1">
		<tr>
			<td style="width:50%">
			<ol>
				<li>The <tt>Client</tt> sends the first request of interest in parking.</li>
				<li>The <tt>ParkManagerService</tt> responds with the <tt>SLOTNUM</tt>.</li>
				<li>The <tt>ParkManagerService</tt> sends the <tt>TOKENID</tt>.</li>
				<li>After some time the <tt>Client</tt> sends the <tt>TOKENID</tt> back.</li>
			</ol>
			Comments:
			<ul>
				<li>The optional response to the <tt>Client</tt> will be addressed in the future.</li>
				<li>We send <tt>TOKENID</tt> and <tt>SLOTNUM</tt> in different messages instead of one, because only when the car has been correctly parked it can be moved out. 
					So to avoid possible errors or confusion.</li>
				<li>There is no response after the <tt>Client</tt> sends <tt>TOKENID</tt>. In the future, there could be an "ok" or a "wait" response.</li>
			</ul>
			</td>
			<td>
				<img src="img\PMSandClientCommunication.png">
			</td>
		</tr>
  </table>
  <br>
  In the other Use-case <ks>the parking slot is already occupied</ks> the communication ends after <tt>Client</tt> receives <tt>SLOTNUM</tt>=0.
 <br>
<h2>Test plans</h2> 

 <h4>Use-case <ks>the parking slot is empty</ks></h4>
 We can generate a client request to park and, after receiving the receipt, exit. 
 To check if the test is successful we need to observe the trolley movement and the message exchange between the application and the client. 
 
 We expect that:
 <ol>
	<li><tt>SLOTNUM</tt> value is 1.</li>
	<li><tt>TOKENID</tt> value is 11.</li> 
	<li>The trolley's final position is <tt>HOME</tt>.</li>
 </ol>
 <h4>Use-case <ks>the parking slot is already occupied</ks></h4>
  We can generate a client request to park. 
  To check if the test is successful we need to observe the trolley movement and the message exchange between the application and the client. 
 
 We expect that:
 <ol>
	<li><tt>SLOTNUM</tt> value is 0.</li>
	<li><tt>TOKENID</tt> is not sent.</li> 
	<li>The trolley did not move and the final position is <tt>HOME</tt>.</li>
 </ol> 

<h2>Project</h2> 
 
</div>

<h2>Testing</h2> 
 

<h2>Deployment</h2> 

 
<h2>Maintenance</h2> 
 
<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white;overflow: auto">
By Emanuele Paci email: emanuele.paci@studio.unibo.it
<br/>
Repository: https://github.com/empaci/Paci-Emanuele-Progetto-Finale-ISS2021
<img src="D:\Scuola\magistrale\IngegneriaDelSoftware\iss2021\AutomatedCarParking\it.unibo.ParkManagerService\userDocs\img\fototessera.png" alt="foto" width="15%" height="15%" style="float:right;">
</div> 
</body>
</html>